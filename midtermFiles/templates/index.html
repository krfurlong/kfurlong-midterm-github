<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">
    <title>Interactive Data Science Midterm-Visualizing International Global Aid, 1960-2016</title>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Custom styles for this project -->
    <link href="css/explore.css" rel="stylesheet">
  </head>
  
  <body role="document">
    
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container" >
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="about">About This Data Set</a></li>
	    	<li><a href="quality">Data Quality</a></li>
	    	<li><a href="map">Heat Map</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    
    <div class="container theme-showcase" role="main">
      
      <!-- Main jumbotron for a primary marketing message or call to action -->
      <div class="jumbotron">
	<h1>Interactive Data Science Midterm - Visualizing International Global Aid, 1960-2016</h1>
        <p>international aid project description here!</p>
      </div>
      
      <div class="page-header">
	
      </div> <!-- /page-header -->
    </div> <!-- /container -->
    
<div class="row">
				<div class="col-md-2">
				</div>
				<div class="col-md-8">
				<p align="center" id="chart"></p>
				</div>
				<div class="col-md-2">
				</div>
</div>

<div class="row">
				<div class="col-md-2">
				</div>
				<div class="col-md-8">
				<br>
				<svg></svg>
				<br>
				</div>
				<div class="col-md-2">
				</div>
</div>
<div class="row">
				<div class="col-md-2">
				</div>
				<div class="col-md-8">
				<br>
				<br>
				</div>
				<div class="col-md-2">
				</div>
</div>

<!-- STYLES FOR D3 -->
 
<style>
/* Styles for date/time chart */
path { 
    stroke: DarkRed;
    stroke-width: 2;
    fill: none;
}

.axis path,
.axis line {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    shape-rendering: crispEdges;
}

div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 100px;					
    height: 28px;					
    padding: 2px;				
    font: 11px sans-serif;		
    background: lightsteelblue;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}

.bar {
  fill: steelblue;
}
.bar:hover {
  fill: brown;
}


</style>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script> 
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/d3-array@1"></script>
	<script src="https://unpkg.com/d3-collection@1"></script>
	<script src="https://unpkg.com/d3-path@1"></script>
	<script src="https://unpkg.com/d3-shape@1"></script>
	<script src="https://unpkg.com/d3-sankey@0"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v0.3.min.js"></script>
	
    <script>
    
    var margin = {top: 20, right: 20, bottom: 20, left: 20},
    	width = 1200 - margin.left - margin.right,
    	height = 900 - margin.top - margin.bottom;
    var formatNumber = d3.format(",.0f"), 
    	format = function(d) { return formatNumber(d); },
    	color = d3.scale.category20b();
    	
    // append the svg canvas to the page
var svg = d3.select("#chart").append("svg")
	.attr("width", '100%')
    .attr("data-height", '0.5678')
    .attr("viewBox",'0 0 1200 900')
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");
   
 // Set the sankey diagram properties
var sankey = d3.sankey()
    .nodeWidth(100)
    .nodePadding(3)
    .size([width, height]);
var path = sankey.link();
// load the data (using the timelyportfolio csv method)
d3.csv("css/donorOECD.csv", function(error, data) {
  graph = {"nodes" : [], "links" : []};
  
  name_list = []
    data.forEach(function (d) {
      name_list.push(d.source);
	  graph.nodes.push({ "name": d.source });
      graph.nodes.push({ "name": d.target });
      graph.links.push({ "source": d.source,
                         "target": d.target,
                         "value": +parseInt(d.value) });
     });
     
   // return only the distinct / unique nodes
     graph.nodes = d3.keys(d3.nest()
       .key(function (d) { return d.name; })
       .map(graph.nodes));
     // loop through each link replacing the text with its index from node
     graph.links.forEach(function (d, i) {
       graph.links[i].source = graph.nodes.indexOf(graph.links[i].source);
       graph.links[i].target = graph.nodes.indexOf(graph.links[i].target);
     });
     //now loop through each nodes to make nodes an array of objects
     // rather than an array of strings
     graph.nodes.forEach(function (d, i) {
       graph.nodes[i] = { "name": d };
     });
	 
	 console.log(graph.nodes);
  	sankey
    	.nodes(graph.nodes)
    	.links(graph.links)
    	.layout(32);
    	
   // add in the links
  var link = svg.append("g").selectAll(".link")
      .data(graph.links)
    .enter().append("path")
      .attr("class", "link")
      .attr("d", path)
      .style("stroke-width", function(d) { return Math.max(1, d.dy); })
      .sort(function(a, b) { return b.dy - a.dy; })
	  .attr("data-title",function(d) { return d.source.name + " vs " + d.target.name + "\n" + format(d.value); });
// add in the nodes
  var node = svg.append("g").selectAll(".node")
      .data(graph.nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { 
		  return "translate(" + d.x + "," + d.y + ")"; })
    .call(d3.behavior.drag()
      .origin(function(d) { return d; })
      .on("dragstart", function() { 
		  this.parentNode.appendChild(this); })
      .on("drag", dragmove));
      
// add the rectangles for the nodes
  node.append("rect")
      .attr("height", function(d) { return d.dy; })
      .attr("width", sankey.nodeWidth())
     .style("fill", function(d,i) { 
		 return d.color = color(i); })
      .style("stroke", function(d) { 
		  return d3.rgb(d.color).darker(2); })
	   .attr('data-title',function(d) { return d.name + "\n" + format(d.value); });
	   
  $("rect").tooltip({container: 'body', html: true, placement:'top'});  
  $("path").tooltip({container: 'body', html: true, placement:'top'}); 	 
// add in the title for the nodes
  node.append("text")
      .attr("x", -6)
      .attr("y", function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", "end")
      .attr("transform", null)
      .text(function(d) { return d.name.charAt(0).toUpperCase()+d.name.slice(1);; })
    .filter(function(d) { return d.x < width / 2; })
      .attr("x", 6 + sankey.nodeWidth())
      .attr("text-anchor", "start");
      
   });
  
  
  
    //$( document ).ready(function() {
	
	
	
	
	
	
	
	
		   
</script>
</body>
</html>
